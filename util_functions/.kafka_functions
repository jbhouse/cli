#!/bin/bash

function kafkaPublishMessage() {
  source ~/.zsh_env;
  TOPIC_NAME=$(jq < ~/Documents/kafka_messages/kafka_map.json | fzf | awk '{ print $2 }' | sed 's/\"//' | sed 's/",.*$//');
  while getopts 'e' flag; do
    case "${flag}" in
      e) micro ~/Documents/kafka_messages/"$TOPIC_NAME".json ;;
      *) print_usage
        exit 1 ;;
    esac
  done
   echo "publishing $HOME/Documents/kafka_messages/$TOPIC_NAME.json to $TOPIC_NAME with brokers $BOOTSTRAP_SERVER"
  jq -rc . "$HOME/Documents/kafka_messages/$TOPIC_NAME.json" | kafka-console-producer --broker-list "$BOOTSTRAP_SERVER" --topic "$TOPIC_NAME"
  # to publish yourself, echo "{}" | kafka-console-producer --broker-list "$BOOTSTRAP_SERVER" --topic "$TOPIC_NAME"
}
# need to first check for the existence of path: ~/Documents/kafka_messages/kafka_map.json
function kafkaConsumeMessage() {
  TOPIC_NAME=$(jq < ~/Documents/kafka_messages/kafka_map.json | fzf | awk '{ print $2 }' | sed 's/\"//' | sed 's/",.*$//');
  echo "consuming from $TOPIC_NAME"
  source ~/.zsh_env;
  echo "kafka-console-consumer --topic $TOPIC_NAME --bootstrap-server $BOOTSTRAP_SERVER $@"
  kafka-console-consumer --topic "$TOPIC_NAME" --bootstrap-server "$BOOTSTRAP_SERVER" "$@"
}

# function consumeKafkaMessageFormatted() {
#   TOPIC_NAME=$(jq < ~/Documents/kafka_messages/kafka_map.json | fzf | awk '{ print $2 }' | sed 's/\"//' | sed 's/",.*$//');
#   echo "consuming from $TOPIC_NAME"
#   source ~/.zsh_env;
#   echo "kafka-console-consumer --topic $TOPIC_NAME --bootstrap-server $BOOTSTRAP_SERVER $@ | jq"
#   kafka-console-consumer --topic "$TOPIC_NAME" --bootstrap-server "$BOOTSTRAP_SERVER" "$@" | jq
# }

# function kafkaPublishToPartition() {
  # echo "{}" | kafka-console-producer --broker-list localhost:9092 --topic mdpo-topic --property "partitioner.class=org.apache.kafka.clients.producer.internals.DefaultPartitioner" --property "key=anyKey" --property "partition=$@"
# }
